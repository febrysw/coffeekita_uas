<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="css/styles.css">
        <link rel="stylesheet" href="css/custom.css">
        <title>Coffe Kita</title>
        <script src="js/jquery-3.6.0.min.js"></script>
    </head>
    <body>
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg">
            <a class="navbar-brand" href="#">CoffeKita</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
              <ul class="navbar-nav">
                <li class="nav-item active">
                  <a class="nav-link" href="index.html">Home <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="produk.html">Produk</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="reservasi.html">Reservasi</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="tentang.html">Tentang</a>
                </li>
              </ul>
            </div>
        </nav>
        <br>
        <section>
            <div class="row">
                <div class="col-md-2"></div>
                <div class="col-md-10">
                    <p class="penilaian"><b>Produk yang anda beli</b></p>
                </div>
            </div>
            <hr>
            <div class="row">
                <div class="col-md-12">
                    <div class="row">
                        <div class="col-md-2"></div>
                        <div class="col-md-2">
                            <img class="gambar-produk" src="img/copy1.png">
                        </div>
                        <div class="col-md-7">
                            <div class="row">
                                <div class="col-md-5">
                                    <p class="penilaian"><b>A ROBUSTA</b></p>
                                </div>
                                <div class="col-md-3"></div>
                                <div class="col-md-4">
                                    <p class="penilaian">☆ ☆ ☆ ☆ ☆</p>
                                </div>
                                
                            </div>
                            <div class="row">
                                <div class="col-md-5">
                                    <p>Total Pesanan</p>
                                </div>
                                <div class="col-md-3"></div>
                                <div class="col-md-4">
                                    <p>1 PCS | $ 3.20</p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-11">
                                    <div class="form-row">
                                        <div class="form-group col-md-11">
                                            <input type="text" name="nama" class="form-control" placeholder="Nama">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-1"></div>
                            </div>
                            <div class="row">
                                <div class="col-md-11">
                                    <div class="form-row">
                                        <div class="form-group col-md-11">
                                            <textarea class="form-control catatan" id="robusta" name="robusta" rows="4" placeholder="Komentar"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-1"></div>
                            </div>
                            <div class="row">
                                <div class="col-md-8"></div>
                                <div class="col-md-2">
                                    <button type="button" class="btn tombol-custom komenRobusta">Kirim Komen</button>
                                </div>
                                <div class="col-md-2"></div>
                            </div>
                        </div>
                        <div class="col-md-1"></div>
                    </div>
                </div>
            </div>
            <hr>
            <div class="row">
                <div class="col-md-12">
                    <div class="row">
                        <div class="col-md-2"></div>
                        <div class="col-md-2">
                            <img class="gambar-produk" src="img/copy1.png">
                        </div>
                        <div class="col-md-7">
                            <div class="row">
                                <div class="col-md-5">
                                    <p class="penilaian"><b>TORABICHO</b></p>
                                </div>
                                <div class="col-md-3"></div>
                                <div class="col-md-4">
                                    <p class="penilaian">☆ ☆ ☆ ☆ ☆</p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3">
                                    <p>Total Pesanan</p>
                                </div>
                                <div class="col-md-5"></div>
                                <div class="col-md-4">
                                    <p>1 PCS | $ 4.00</p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-11">
                                    <div class="form-row">
                                        <div class="form-group col-md-11">
                                            <input type="text" name="nama" class="form-control" placeholder="Nama">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-1"></div>
                            </div>
                            <div class="row">
                                <div class="col-md-11">
                                    <div class="form-row">
                                        <div class="form-group col-md-11">
                                            <textarea class="form-control catatan" id="torabica" name="torabica" rows="4" placeholder="Komentar"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-1"></div>
                            </div>
                            <div class="row">
                                <div class="col-md-8"></div>
                                <div class="col-md-2">
                                    <button type="button" class="btn tombol-custom komenTorabica">Kirim Komen</button>
                                </div>
                                <div class="col-md-2"></div>
                            </div>
                        </div>
                        <div class="col-md-1"></div>
                    </div>
                </div>
            </div>
            <hr>
            <div class="row">
                <div class="col-md-12">
                    <div class="row">
                        <div class="col-md-2"></div>
                        <div class="col-md-2">
                            <img class="gambar-produk" src="img/copy1.png">
                        </div>
                        <div class="col-md-7">
                            <div class="row">
                                <div class="col-md-5">
                                    <p class="penilaian"><b>MOCACHINO SPESIAL</b></p>
                                </div>
                                <div class="col-md-3"></div>
                                <div class="col-md-4">
                                    <p class="penilaian">☆ ☆ ☆ ☆ ☆</p>
                                </div>
                                
                            </div>
                            <div class="row">
                                <div class="col-md-5">
                                    <p>Total Pesanan</p>
                                </div>
                                <div class="col-md-3"></div>
                                <div class="col-md-4">
                                    <p>1 PCS | $ 3.00</p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-11">
                                    <div class="form-row">
                                        <div class="form-group col-md-11">
                                            <input type="text" name="nama" class="form-control" placeholder="Nama">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-1"></div>
                            </div>
                            <div class="row">
                                <div class="col-md-11">
                                    <div class="form-row">
                                        <div class="form-group col-md-11">
                                            <textarea class="form-control catatan" id="moca" name="moca" rows="4" placeholder="Komentar"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-1"></div>
                            </div>
                            <div class="row">
                                <div class="col-md-8"></div>
                                <div class="col-md-2">
                                    <button type="button" class="btn tombol-custom komenMoca">Kirim Komen</button>
                                </div>
                                <div class="col-md-2"></div>
                            </div>
                        </div>
                        <div class="col-md-1"></div>
                    </div>
                </div>
            </div>
            <hr>
        </section>
        <script>
            $(document).ready(function(){
                $(".komenRobusta").click(robusta);
                $(".komenTorabica").click(torabica);
                $(".komenMoca").click(moca);

                
                function robusta() {
                    var data = new Object();
                    data.produkId = 1;
                    data.nama = $("input[name='nama']").val();
                    data.komentar = $("textarea[id='robusta']").val();
                    $.ajax({
                        type:'POST',
                        url: 'http://localhost:8888/reviews',
                        data: JSON.stringify(data),
                        contentType:'application/json',
                        success:function(data){
                            cekKomen(data, data.komentar);
                        },
                        error:function(error){
                            console.log(error);
                        }
                    });
                }
                
                function torabica() {
                    var data = new Object();
                    data.produkId = 3;
                    data.nama = $("input[name='nama']").val();
                    data.komentar = $("textarea[id='torabica']").val();
                    $.ajax({
                        type:'POST',
                        url: 'http://localhost:8888/reviews',
                        data: JSON.stringify(data),
                        contentType:'application/json',
                        success:function(data){
                            cekKomen(data, data.komentar);
                        },
                        error:function(error){
                            console.log(error);
                        }
                    });
                }
                
                function moca() {
                    var data = new Object();
                    data.produkId = 2;
                    data.nama = $("input[name='nama']").val();
                    data.komentar = $("textarea[id='moca']").val();
                    $.ajax({
                        type:'POST',
                        url: 'http://localhost:8888/reviews',
                        data: JSON.stringify(data),
                        contentType:'application/json',
                        success:function(data){
                            cekKomen(data, data.komentar);
                        },
                        error:function(error){
                            console.log(error);
                        }
                    });
                }

                function getRandomInt(min, max) {
                    return Math.round((min - 0.5) + Math.random() * (max - min + 1));
                }
    
                function cekSara(data, komen) {
                    return new Promise((resolve, reject) => {
                        $.ajax({
                            type:'GET',
                            url: 'http://localhost:8888/sara/',
                            success: function(data){
                            var ketemu = data.find(x => x.nama === komen);
                            if(ketemu){
                                console.log('sara');
                                nilai = getRandomInt(1,50);
                                resolve(nilai);
                            }
                            else{
                                reject('tidak termasuk sara')
                            }
                            },
                            error:function(error){
                                reject(error);
                                console.log("error");
                            }
                        });
                    })
                }
    
                function cekBaik(data, komen) {
                    return new Promise((resolve, reject) => {
                        $.ajax({
                            type:'GET',
                            url: 'http://localhost:8888/baik/',
                            success: function(data){
                            var ketemu = data.find(x => x.nama === komen);
                            if(ketemu){
                                console.log('baik');
                                nilai = getRandomInt(81,100);
                                resolve(nilai);
                            }
                            else{
                                reject('tidak termasuk baik')
                            }
                            },
                            error:function(error){
                                reject(error);
                                console.log("error");
                            }
                        });
                    })
                }
    
                function cekKomen(data, komen) {
                    cekSara(data, komen).then((nilaisara) => {
                        ubahKomen(data, komen, nilaisara)
                    }).catch((error)=>{
                        cekBaik(data, komen).then((nilaibaik) => {
                            ubahKomen(data, komen, nilaibaik)
                        }).catch(()=>{
                            nilaiselain = getRandomInt(51, 79)
                            ubahKomen(data, komen, nilaiselain)
                        })
                    })
                }
                        
                function ubahKomen(param, komen, nilai) {
                    var data = new Object();
                    data.produkId = param.produkId;
                    data.nama = param.nama;
                    data.komentar = komen;
                    data.nilai = nilai;
    
                    $.ajax({
                        type:'PUT',
                        url: 'http://localhost:8888/reviews/'+param.id,
                        data: JSON.stringify(data),
                        contentType:'application/json',
                        success:function(data){
                        },
                        error:function(error){
                        console.log(error);
                        }
                    });
                }
            });
        </script>
    </body>
    <footer>        
        <p>CoffeKita</p>
    </footer>
    <!-- <script src="js/jquery-3.6.0.min.js"></script> -->
    <script src="js/popper.js"></script>
    <script src="js/bootstrap.js"></script>
</html>
